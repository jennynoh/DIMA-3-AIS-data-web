<!DOCTYPE html>
<html lang="ko" xmlns:th="http://thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Port Congestion Service Home</title>

    <!-- í˜ì´ì§€ css ì¶”ê°€ -->
    <link rel="stylesheet" th:href="@{/css/liveChat.css}" />
    <link rel="stylesheet" th:href="@{/css/glv.css}" />
    <script th:src="@{/script/jquery-3.7.1.min.js}"></script>
    <!-- ì›¹ì†Œì¼“ STOMP í”„ë¡œí† ì½œ script -->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client/dist/sockjs.min.js"></script>
    <script th:src="@{/script/stomp.min.js}"></script>
    <script th:src="@{/script/liveChat.js}" defer></script>
    <script>
        const nav = document.querySelector('.global-navigation-bar');
        let lastScrollY = window.scrollY;

        $(function () {
            // ë¡œê·¸ì¸/íšŒì›ê°€ì… ì•¡ì…˜
            $(".log-in").on('click', function () {
                window.location.href = "/user/login";
            });
            $(".sign-up").on('click', function () {
                window.location.href = "/user/join";
            });
            $(".log-out").on('click', function () {
                window.location.href = "/user/logout";
            });
            $(".my-page").on('click', function () {
                // window.location.href = "/user/mypage";
            })
            // ìŠ¤í¬ë¡¤ ì•¡ì…˜ 
            $(document).on('scroll', () => {
                console.log(lastScrollY);
                if (window.scrollY > lastScrollY) { // ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤
                    console.log("ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤");
                    $('.global-navigation-bar').addClass('hide');
                } else { // ìœ„ë¡œ ìŠ¤í¬ë¡¤
                    console.log("ìœ„ë¡œ ìŠ¤í¬ë¡¤");
                    $('.global-navigation-bar').removeClass('hide');
                }
                lastScrollY = window.scrollY;
            });

        });

        // ë³¸ë¬¸ ë™ì‘
        $(function () {
            // // ì›¹ì†Œì¼“ ì—°ê²°  
            // $(document).ready(function () {
            //     let portCD = $("#portCD").val();
            //     var wsUrl = "ws://localhost:9999/ws/chat"; // ì›¹ì†Œì¼“ ì„œë²„ url
            //     // var wsUrl = "ws://localhost:9999/ws/chat/" + portCD; // ì›¹ì†Œì¼“ ì„œë²„ url
            //     var ws = new WebSocket(wsUrl);  // ì›¹ì†Œì¼“ ê°ì²´ ìƒì„± 

            //     ws.onopen = function () {
            //         console.log("Connected to" + wsUrl);
            //         // ì›¹ì†Œì¼“ ì—°ê²° ì‹œ ìˆ˜í–‰í•  ë™ì‘ 

            //         // ì›¹ì†Œì¼“ ë³´ë‚´ê¸°
            //         $("#send-button").on('click', function () {
            //             // buttonì´ enabled ë˜ì–´ìˆìœ¼ë©´..
            //             if (!$(this).prop('disabled')) {
            //                 let message = $("#message-field").val();
            //                 console.log("ë³´ë‚´ëŠ” ë©”ì„¸ì§€: " + message);
            //                 // websocket ë©”ì„¸ì§€ ë³´ë‚´ê¸°
            //                 let sendMessage = {
            //                     "messageType": "TALK",
            //                     "roomId": 1,
            //                     "senderId": 1,
            //                     "message": message
            //                 };
            //                 ws.send(JSON.stringify(sendMessage));

            //                 // ë©”ì„¸ì§€ ì…ë ¥ì°½ ì´ˆê¸°í™”
            //                 $("#message-field").val(null);
            //             }
            //         })
            //     };

            //     ws.onmessage = function (event) {
            //         // ì„œë²„ë¡œë¶€í„° ë©”ì„¸ì§€ë¥¼ ë°›ì•˜ì„ ë•Œ ìˆ˜í–‰í•  ë™ì‘ 
            //         console.log("Received message: " + event.data);
            //     };

            //     ws.onclose = function () {
            //         // ì›¹ì†Œì¼“ ì—°ê²°ì´ ë‹«í˜”ì„ ë–„ ìˆ˜í–‰í•  ë™ì‘ 
            //         console.log("Disconnected from " + wsUrl);
            //     };

            //     ws.onerror = function (error) {
            //         // ì˜¤ë¥˜ ë°œìƒ ì‹œ ìˆ˜í–‰í•  ë™ì‘
            //         console.log("WebSocket error: " + error);
            //     };

            //     // ì‚¬ìš©ìê°€ ì›¹í˜ì´ì§€ë¥¼ ë– ë‚  ë•Œ ì›¹ì†Œì¼“ ì—°ê²° ì¢…ë£Œ 
            //     function closeWebSocket() {
            //         if (ws) {
            //             ws.close();
            //         }
            //     }
            //     $(window).on('beforeunload', closeWebSocket);

            // });

            // ì±„íŒ… ë©”ì„¸ì§€ ì…ë ¥
            $("#message-field").on('keyup', function () {
                let text = $("#message-field").val();
                if (text.length != 0) {
                    $("#img-change-to").attr('src', '/img/paper_airplane_white.svg');
                    $("#send-button").prop('disabled', false);
                } else {
                    $("#img-change-to").attr('src', '/img/paper_airplane_gray.svg');
                    $("#send-button").prop('disabled', true);
                }
            });

            // toggle ë™ì‘ - ì•ˆë¨¹í˜ 
            $(".slider").on('click', function () {
                $(this).siblings("input:checkbox").prop('checked', function (i, val) {
                    return !val;
                });
            });


        });


    </script>
</head>

<body>
    <div class="global-navigation-bar">
        <div class="navigation-menu">
            <div class="menu"><a th:href="@{/}">Home</a></div>
            <div class="menu"><a th:href="@{/portStatus}">Port Status</a></div>
            <div class="menu"><a th:href="@{/port}">Vessel Schedule</a></div>
            <div class="menu"><a th:href="@{/marineNews}">Marine News</a></div>
            <div class="menu"><a th:href="@{/subscription}">Subscription</a></div>
        </div>
        <div class="user-menu">
            <button class="log-in" sec:authorize="isAnonymous()">Log in</button>
            <button class="sign-up" sec:authorize="isAnonymous()">Sign up</button>
            <button class="log-out" sec:authorize="isAuthenticated()">Log out</button>
            <button class="my-page" sec:authorize="isAuthenticated()">My page</button>
        </div>
    </div>

    <!-- ë³¸ë¬¸ -->
    <input type="hidden" id="portId" value="SGSIN">
    <input type="hidden" id="user" value="ì±„íŒ…ìœ ì €">
    <!-- ì±„íŒ…ë°© -->
    <div class="chat-window">
        <div class="chat-header">
            <div class="chat-title">
                <!-- portcd ë°›ì•„ì„œ ë™ì ìœ¼ë¡œ ë³€ê²½ -->
                <span>ğŸ‡­ğŸ‡° Hongkong Port</span>
            </div>
            <div class="toggle">
                <label class="switch">
                    <input type="checkbox" checked>
                    <span class="slider round"></span>
                </label>
            </div>
        </div>
        <div class="chat-message-window">

        </div>
        <div class="chat-input-bar">
            <div class="emoji"><img th:src="@{/img/emoji.svg}" alt=""></div>
            <div class="text-field">
                <input type="text" id="message-field" name="message" placeholder="Start typing...">
            </div>
            <div class="send-box">
                <div class="mention"><img th:src="@{/img/mention.svg}" alt=""></div>
                <div class="send-button-container">
                    <button id="send-button" disabled>
                        <img id="img-change-to" th:src="@{/img/paper_airplane_gray.svg}" alt="">
                    </button>
                </div>
            </div>
        </div>
    </div>


</body>

</html>