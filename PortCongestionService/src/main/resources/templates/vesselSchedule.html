<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        /* 로더 스타일 */
        .loader {
            border: 16px solid #f3f3f3; /* Light grey */
            border-top: 16px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 70px;
            height: 70px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 로딩 화면 전체 커버 */
        #loading {
            position: top; /* 절대적 위치 */
            z-index: 999;
            width: 100%;
            top: 90%; /* 표 아래에 위치하도록 수정 */
            transform: translateY(-50%); /* 세로 중앙 정렬 */
            background-color: rgba(248, 248, 248, 0.6);
            color: #fff;
            text-align: center;
            line-height: 100vh; /* 중앙 정렬 */
            margin-top: 120px;
            margin-left: 190px;
        }


    </style>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
        
        // ======================================== 페이지 로드 ========================================
        // 기본으로 보여줄 테이블 : 해상 스케줄
        $(function(){
            $("#btn").on('click', retrieveVessel);
            $("#containerSchBtn").on('click', retrieveTerminal);
            $("#vesselSchBtn").on('click', function(){
                // 출발항, 도착항 입력하는 div 보이게 만들기
                document.getElementById("inputPort").style.display = 'block';
                // 테이블 비우기
                clearTable();
            });
        });

        // 테이블 내용 지우는 함수
        function clearTable() {
            // tbody와 thead를 모두 선택하여 삭제
            $('#myTable > thead, #myTable > tbody').empty();
        }
        
        
        // 해상 스케줄 데이터 불러오는 함수
        function retrieveVessel() {          
            
            let dep_port = $("#dep_port").val();
            let arr_port = $("#arr_port").val();

            let sendData = {"depPort" : dep_port, "arrPort": arr_port};
            $.ajax({
                url : "/port_info",
                method: "GET",
                data : sendData,
                success : function(response) {
                    
                    addVessel(response); // AJAX 호출이 성공한 후에 add() 함수 호출
                },
                error: function(xhr, status, error) {
                    console.error("AJAX request failed:", status, error);
                }
            });
        }

        // 불러온 해상 스케줄 데이터 테이블에 뿌리는 함수
        function addVessel(response) {
            console.log(response);

            // thead 넣기
            var vesselThead = '<th>Carrier</th><th>Name/Vessel</th>' + 
            '<th>Origin</th><th>Destination</th>'+
            '<th>T/Time</th><th>T/S</th><th>O/F(20\'/40\')</th>'
            $("#tableHead").append(vesselThead);


            // 받은 데이터를 테이블에 넣기
            // 기존의 tbody 선택
            var tbody = $("#tableBody");

            // response에 대한 반복문
            $.each(response, function(index, item) {
                // 행(tr) 생성
                var row = $("<tr>");
                    
                // 각 셀(td)에 데이터 추가
                // tr 하나당 td 7개 필요
                row.append('<td><div> <img src="' + item['logo_img'] + '""> </div></td>');
                // row.append('<td><div>' + logo + '</div></td>');
                // 2번째 td - div - p,span (선사명, 선박명)
                row.append('<td><div><p>' + item['company_name'] + '</p><span>' + item['vessel_name'] + '</span></div></td>');
                // 3번째 td - div - p,p (출발항, 출발일)
                row.append('<td><div><p>' + item['origin'] + '</p><p>' + item['dep_time'] + '</p></div></td>');
                // 4번째 td - div - p,p (도착항, 도착일)
                row.append('<td><div><p>' + item['destination'] + '</p><p>' + item['arr_time'] + '</p></div></td>');
                // 5번째 td - div (소요시간)
                row.append('<td><div>' + item['duration'] + '</div></td>');
                // 6번째 td - div (환적여부)
                row.append('<td><div>' + item['trans'] + '</div></td>');
                // 7번째 td - div - span,span (운임비 20',40')
                row.append('<td><div><span>' + item['of20'] + '</span><span>' + item['of40'] + '</span></div></td>');

                // 행을 tbody에 추가
                tbody.append(row);
            });
        }


        // 컨테이너 터미널 스케줄 데이터 불러오는 함수
        function retrieveTerminal() {

            // 테이블 내용 비우기
            clearTable();

            // 출발항, 도착항 입력하는 div 안보이게 만들기
            document.getElementById("inputPort").style.display = 'none';

            $.ajax({
                url : "/get_terminalSchedule",
                method: "GET",
                success : function(response) {
                    addTerminal(response); // AJAX 호출이 성공한 후에 add() 함수 호출
                },
                error: function(xhr, status, error) {
                    console.error("AJAX request failed:", status, error);
                }
            });
        }

        // 불러온 터미널 스케줄 데이터 테이블에 뿌리는 함수
        function addTerminal(response) {
            console.log(response);

             // thead 넣기
             var terminalThead = '<th>Port</th><th>Terminal</th>'+
                '<th>Vessel Name</th><th>터미널 항차</th>' +
                '<th>Cut-off(closed)</th><th>Arrival(ETA)</th>' +
                '<th>Departure(ETD)</th><th>Carrier</th>'
            $("#tableHead").append(terminalThead);

            // 받은 데이터를 테이블에 넣기
            // 기존의 tbody 선택
            let tbody = $("#tableBody");

            // response에 대한 반복문
            $.each(response, function(index, item) {
                // 행(tr) 생성
                var row = $("<tr>");
                    
                // 각 셀(td)에 데이터 추가
                // tr 하나당 td 8개 필요
                // 1번째 td - Port
                row.append('<td><div>' + item['Port'] + '</div></td>');
                // 2번째 td - Terminal
                row.append('<td><div>' + item['Terminal'] + '</div></td>');
                // 3번째 td - Vessel Name
                row.append('<td><div>' + item['Vessel Name'] + '</div></td>');
                // 4번째 td - Vessel Call
                row.append('<td><div>' + item['Vessel Call'] + '</div></td>');
                // 5번째 td - Cut-off
                row.append('<td><div>' + item['Cut-off'] + '</div></td>');
                // 6번째 td - Arrival
                row.append('<td><div>' + item['Arrival'] + '</div></td>');
                // 7번째 td - Departure
                row.append('<td><div>' + item['Departure'] + '</div></td>');
                // 8번째 td - Carrier
                row.append('<td><div>' + item['Carrier'] + '</div></td>');

                // 행을 tbody에 추가
                tbody.append(row);
            });
        }


    </script>
</head>
<body>
    <h1>해상 스케줄</h1>
    <div id="changeTableBtn" style="display: block;">
        <input type="button" value="해상 스케줄" id="vesselSchBtn">
        <input type="button" value="터미널 스케줄" id="containerSchBtn">
    </div>
    <div>
        <div id="inputPort">
        <div>Point to Point</div>
            <span>출발지</span>
            <input autocomplete="off" type="text" id="dep_port" placeholder="출발항을 입력해주세요">
            <div>
                <span>도착지</span>
                <input autocomplete="off" type="text" id="arr_port" placeholder="도착항을 입력해주세요">
            </div>
            <div>
                <input type="button" value="조회" id="btn">
            </div>
        </div>
    </div>
    <div class="schedule-container">
        <table id="myTable">
            <thead id="tableHead"></thead> <!-- 표의 컬럼명 부분 -->
            <tbody id="tableBody"></tbody> <!-- 표의 본문 부분 -->
        </table>
    </div>
</body>
</html>